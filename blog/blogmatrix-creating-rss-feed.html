
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>BlogMatrix - Creating an RSS Feed with C# &middot; Kestrel Blackmore</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Creating the RSS Feed using C# for my blog engine BlogMatrix">
    <meta name="author" content="Kestrel Blackmore">

    <!-- CSS -->
    <link href="/assets/css/metro-bootstrap.css" rel="stylesheet" type="text/css" />
    <link href="http://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
   
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="/assets/ico/apple-touch-icon-57-precomposed.png">
  </head>

  <body>


    <!-- Part 1: Wrap all page content here -->
    <div id="wrap">

      <!-- Begin page content -->
      <div class="container">
        
        <div class="row hidden-desktop hidden-tablet"> <!-- start responsive menu -->

          <div class="span12">
            
            <div class="navbar">
              <div class="navbar-inner">
                <div class="container" style="width: auto;">
                  <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                  </a>
                  <a class="brand" href="#">Menu</a>
                  <div class="nav-collapse">
                    <ul class="nav">
                      <li><a href="/">Home</a></li>
                      <li><a href="/about">About</a></li>
                      <li><a href="/archives">Archives</a></li>
                      <li><a href="/projects/blogmatrix">BlogMatrix</a></li>
                    </ul>
                    
                  </div><!-- /.nav-collapse -->
                </div>
              </div><!-- /navbar-inner -->
            </div>


          </div>
        </div> <!-- end responsive menu -->

        <div class="row">
   
          <div class="span10"> <!-- start main content -->
            



<section id="page_title">
    <div class="page-header">
        <h2>BlogMatrix <small>creating an rss feed with C#</small></h2>
    </div>
</section>

<section id="page_content">
    

<section id="blog">
    <div class="alert alert-warning">
    <p><strong>This page is part of a series on my  blog engine called BlogMatrix.</strong> The full series is listed below. Enjoy.</p>
    <dl>
        <dd><a href="/projects/blogmatrix">1. BlogMatrix - A very simple blog engine</a></dd>
        <dd><a href="/blog/blogmatrix-brief-overview">2. BlogMatrix - A brief overview</a></dd>
        <dd><a href="/blog/blogmatrix-deployment-process">3. BlogMatrix - The deployment process</a></dd>
        <dd><a href="/blog/blogmatrix-creating-rss-feed">4. BlogMatrix - Creating the RSS feed</a></dd>
    </dl>
    </div>

    
   
</section>


    <p class='lead'>Up to this point my blog engine has been working quite nicely; however, it does lack one key feature: an RSS feed. 
        Without support for RSS people will have to continually come back to my website to check for new posts. That's not likely to occur :( 
        So let's fix this and get an RSS feed up and running!
    </p>
    
    <p>RSS is widely known as <em>Really Simple Syndication</em> and is a standardised format that allows publishers (blog owners) to syndicate data (posts) automatically.</p>

    <p>Think of it like this. There are two basic ways I can get the latest newspaper: go to the local newsagent or get it delivered to my house. RSS is the equivalent of getting the newspaper delivered to my house. It gets 'syndicated' to me whenever the latest copy is available.</p>

    <p>There are a number of standardised formats for an RSS feed but at their most basic level they are an XML file. Knowing this means we have a number of options available for constructing ourfeed.</p>

    <h3>Option 1. Manually Construct</h3>
    <p>Because it's XML we could just concatenate together a bunch of strings wrapping them in the correct XML tags.</p>
    <p>If you head over to the <a href="http://www.rssboard.org/rss-2-0">rss advisory board</a> you can read through the RSS 2.0 specification. There you will find the structure for the XML file and its elements. Then it's just a matter of concatenating strings of data and XML together.</p>
    <p>It doesn't take a rocket scientist to know that this will get messy very quickly and is susceptible to bugs! So for obvious reasons we will not use this method.</p>

    <h3>Option 2. Serialize a Class Model</h3>
    <p>Seeing as we have the <a href="http://www.rssboard.org/rss-2-0">RSS 2.0 specification</a> we could create our own class model. Then it'd just be a matter of serializing to XML and bingo, it's done! 
       However once again this requires creating a lot of infrastructure code and processes.</p>
    <p>There has to be an easier way!</p>

    <h3>Option 3. Use the System.ServiceModel.Syndication namespace</h3>
    <p>As luck would have it there is! Check out the<a href="http://msdn.microsoft.com/en-us/library/system.servicemodel.syndication(v=vs.110).aspx">System.ServiceModel.Syndication namespace</a> in .NET. The classes of particular interest are: <code>SyndicationFeed</code>, <code>SyndicationLink</code> and <code>SyndicationItem</code>.</p>
        <ul>
            <li><code>SyndicationFeed</code> provides information about your blog.</li>
            <li><code>SyndicationLink</code> provides information about links.</li> 
            <li><code>SyndicationItem</code> provides information about blog posts.</li>
        </ul>
    </p>
    <p>Here's a quick and dirty example using my blog. <a href="https://github.com/kestrelblackmore/BlogMatrix/blob/master/App_Code/RssSyndicator.cs">View the github page</a> to see the proper class.</p>

<pre class="prettyprint">
 var feed = new SyndicationFeed();

// Add basic blog information
feed.Id = pbaseUrl;
feed.Title = new TextSyndicationContent("Kestrel Blackmore Blog");
feed.Description = new TextSyndicationContent("Hi, I'm Kestrel. I've been a software developer now for 10+ years and I love it!");
feed.Copyright = new TextSyndicationContent("Kestrel Blackmore");
feed.LastUpdatedTime = new DateTimeOffset(DateTime.Now);
feed.Generator = "BlogMatrix 1.0";
feed.ImageUrl = new Uri(pbaseUrl + "/assets/img/blackmore_logo.png");

// Add the URL that will link to your published feed when it's done
SyndicationLink link = new SyndicationLink(new Uri(pbaseUrl + "/feed.xml"));
link.RelationshipType = "self";
link.MediaType = "text/html";
link.Title = "Kestrel Blackmore Feed";
feed.Links.Add(link);

// Add your site link
link = new SyndicationLink(new Uri(pbaseUrl));
link.MediaType = "text/html";
link.Title = "Kestrel Blackmore Blog";
feed.Links.Add(link);

// get blog posts
var items = new List<SyndicationItem>();

foreach(var post in myPosts) {
    var item = new SyndicationItem();
    item.Title = TextSyndicationContent.CreatePlaintextContent(post.Value.title);
    item.Links.Add(SyndicationLink.CreateAlternateLink(new Uri(pbaseUrl + post.Value.link.url)));
    item.Summary = TextSyndicationContent.CreateHtmlContent(post.Value.summary);
    var date = DateTime.Parse(post.Value.publish_date);
    item.PublishDate = new DateTimeOffset(date);
    item.Authors.Add(new SyndicationPerson(post.Value.author.email, post.Value.author.name, post.Value.author.url));
    items.Add(item);
}

feed.Items = items;
</pre>

    <p>The above will create the required objects for an RSS feed. Now we need an endpoint so the feed can be consumed.</p>

<h3>Creating the RSS endpoint</h3>
<p>Creating the endpoint is as simple as writing some XML to Response.Output and setting the relevant Response.ContentType.</p>
<p>Here's the code (Remember I'm using WebMatrix with Razor Pages so YMMV):</p>
<pre class="prettyprint">
var feedWriter = XmlWriter.Create(Response.OutputStream);

// feed object is from previous code example
Rss20FeedFormatter rssFormatter = new Rss20FeedFormatter(feed);
rssFormatter.WriteTo(feedWriter);

Response.ContentType = "application/rss+xml";

feedWriter.Close();
</pre>
    <p>Note the use of the <code>Rss20FeedFormatter</code> class?  We could have used an <code>Atom10FeedFormatter</code> instead. Check out the <a href="http://msdn.microsoft.com/en-us/library/system.servicemodel.syndication(v=vs.110).aspx">System.ServiceModel.Syndication namespace</a> for more formatter options.</p>

    <h3>Conclusion</h3>
    <p>Creating an RSS feed with C# is pretty darn easy! To see the full code listing view my <a href="https://github.com/kestrelblackmore/BlogMatrix">BloxMatrix github repository</a> and check out the code in:</p>
<pre>
App_Code\RssSyndicator.cs
feed.cshtml
</pre>
<p>Next post I'll be looking at how I get the blog post information (I don't use a database for my blog engine) for my RSS feed and how I used this to also refactor my Home and Archives pages.</p>
  
</section>




<div class="row">
    <div class="span10"><hr></div>
</div>

<div id="social_media" class="row">
    <div id="social_media_twitter" class="span1">
        <a href="https://twitter.com/share" class="twitter-share-button" data-via="kestrelblackmor">Tweet</a>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    </div>
</div>

<div class="row">
    <div class="span10"><hr></div>
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'kestrelblackmore'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


          </div> <!-- end main content -->
          

          <div class="span2 hidden-phone"> <!-- start sidebar -->
            
            <h3>&nbsp;</h3>

            <ul class="nav nav-list">
              <li><a href="/">Home</a></li>
              <li><a href="/about">About</a></li>
              <li><a href="/archives">Archives</a></li>
              <li class="nav-header">Projects</li>
              <li><a href="/projects/blogmatrix">BlogMatrix</a></li>
            </ul>

          </div> <!-- end sidebar -->
         

        </div> <!-- row -->
              
      </div> <!-- container -->

    </div> <!-- wrap -->

    

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/javascript" src="/assets/js/jquery-1.8.0.js"></script>
    <script type="text/javascript" src="/assets/js/bootstrap-tooltip.js"></script>
    <script type="text/javascript" src="/assets/js/bootstrap-alert.js"></script>
    <script type="text/javascript" src="/assets/js/bootstrap-button.js"></script>
    <script type="text/javascript" src="/assets/js/bootstrap-carousel.js"></script>
    <script type="text/javascript" src="/assets/js/bootstrap-collapse.js"></script>
    <script type="text/javascript" src="/assets/js/bootstrap-dropdown.js"></script>
    <script type="text/javascript" src="/assets/js/bootstrap-modal.js"></script>
    <script type="text/javascript" src="/assets/js/bootstrap-popover.js"></script>
    <script type="text/javascript" src="/assets/js/bootstrap-scrollspy.js"></script>
    <script type="text/javascript" src="/assets/js/bootstrap-tab.js"></script>
    <script type="text/javascript" src="/assets/js/bootstrap-transition.js"></script>
    <script type="text/javascript" src="/assets/js/bootstrap-typeahead.js"></script>
    <script type="text/javascript" src="/assets/js/jquery.validate.js"></script>
    <script type="text/javascript" src="/assets/js/jquery.validate.unobtrusive.js"></script>
    <script type="text/javascript" src="/assets/js/jquery.unobtrusive-ajax.js"></script>
    <script type="text/javascript" src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js?lang=css&skin=sons-of-obsidian"></script>

    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-32181347-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
  </body>
    
</html>

